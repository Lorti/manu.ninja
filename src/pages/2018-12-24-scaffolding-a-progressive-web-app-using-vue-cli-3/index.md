---
path: /scaffolding-a-progressive-web-app-using-vue-cli-3
title: Scaffolding a Progressive Web App using Vue CLI 3
htmlTitle: Scaffolding a Progressive Web App using Vue&nbsp;CLI&nbsp;3
date: 2018-12-24
categories: [coding]
tags: [meetups, pwa, slides, tools, vue]
thumbnail: /images/vue-cli-3-pwa/scaffolding-a-progressive-web-app-using-vue-cli-3.jpg
---

Vue CLI 3 has been released and it's completely different from its previous version. Discover how it simplifies your toolchain, reduces configuration fatigue and improves your developer experience.

This guide is intended for beginners who've never used Vue as well as veterans who've already used Vue CLI 2 and wish to quickly start building projects with Vue CLI 3.

## Vue? Vue CLI?

> Vue (/vjuː/) is a progressive framework for building user interfaces. 

You may already heard that, if you've stumbled upon this guide. The word "progressive" means, that there's a very quick learning curve as you can start to use just a little of what the framework provides and gradually use and learn more and more concepts. But what is the Vue CLI?

The first and second versions of the Vue CLI have been primarily a tool for scaffolding Vue projects. After the CLI had prepared a project for you you wouldn't need or use the Vue CLI anymore. The Vue CLI 3 is different, in that it is meant as a companion for Vue developers. It's a full system for rapid Vue development that you'll be using constantly while developing your application.

> Vue CLI is a <strike>tool for scaffolding Vue projects</strike> full system for rapid development.

The new CLI is also more in line with Vue's goals of being a progressive framework. Whereas the Vue CLI 2 scaffolded a large project with 500-1000 lines of configuration code in multiple files for you (when using the webpack template), the Vue CLI 3 hides away this complexity and let's you start with a very simple setup, allowing you to fully customize its parts and go deeper as soon as, and only if, you need it.

## Install Vue CLI 3

The first thing to do, obviously, is to install Vue CLI 3. Like with any command-line tool, the Vue.js team recommends to globally install Vue CLI 3. However, before you do that, you should remove Vue CLI 2, to avoid any conflicts caused by remaining files. 

For both removing Vue CLI 2 and installing Vue CLI 3 you can use the package manager you prefer (npm or Yarn) and run the following commands:

```bash
npm uninstall vue-cli -g
npm install -g @vue/cli
```

```bash
yarn global remove vue-cli
yarn global add @vue/cli
```

Take note, that the Vue CLI 3 package is `@vue/cli`, not `vue-cli`. Every npm package that has to do with Vue CLI 3 is prefixed with `@vue`.

## Create a new project

You now have a global `vue` tool which you can use to do various things. Run `vue --help` to get a list of all commands. The first command we'll be using is `vue create`. You call it with the name of the application you want to create:

```bash
vue create my-project
```

The Vue CLI then presents you with a few prompts. These kinds of prompts will show up often when working with the Vue CLI.

It asks you to pick a preset or manually select your application's features. For this example we'll be going the manual route, so that we can start with a simple and minimal application. Select only `Babel` and `Linter` (`ESLint + Airbnb`) and place all config in `package.json`.

![Vue CLI v3.0.3
  ? Please pick a preset: Manually select features
  ? Check the features needed for your project: Babel, Linter
  ? Pick a linter / formatter config: ESLint + Airbnb config
  ? Pick additional lint features: Lint on save
  ? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In p
  ackage.json
  ? Save this as a preset for future projects? No](/images/vue-cli-3-pwa/vue-create.png)

The CLI will then download and resolve the necessary dependencies, install CLI plugins and print progress output. When it's done you can open the created folder and run `npm run serve`, which will fire up a hot-reloading development server at `http://localhost:8080/`.
 
```bash
cd my-project
npm run serve
```

### What's in a project?

Let's now inspect the generated folder and you'll find 4 directories with 10 files:

```txt
my-project
├── README.md
├── babel.config.js
├── package-lock.json
├── package.json
├── public
│   ├── favicon.ico
│   └── index.html
└── src
    ├── App.vue
    ├── assets
    │   └── logo.png
    ├── components
    │   └── HelloWorld.vue
    └── main.js
```

If you are familiar with Vue CLI 2 you'll notice right away, that these are way fewer files with even fewer lines of code (compared to running `vue init webpack my-project` back then). That means the projects generated by Vue CLI 3 are easier to understand and demand less time and effort to get an overview of.

The same is true for the project's `package.json` file. Whereas a project created with Vue CLI 2 had dozens of dependencies listed, our application has only a few dependencies (this of course depends on what you've selected in the prompts):

```json
{
  "dependencies": {
    "vue": "^2.5.21"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "^3.2.0",
    "@vue/cli-plugin-eslint": "^3.2.0",
    "@vue/cli-service": "^3.2.0",
    "@vue/eslint-config-airbnb": "^4.0.0",
    "babel-eslint": "^10.0.1",
    "eslint": "^5.8.0",
    "eslint-plugin-vue": "^5.0.0",
    "vue-template-compiler": "^2.5.21"
  }
}
```

We'll get into the details of the `@vue` packages in the next sections. Before that let's head to the `scripts` field.

### Understanding `vue-cli-service`

```json
{
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint"
  }
}
```

When you've run `npm run serve` you might have already noticed, that npm runs the `vue-cli-service serve` command. The `vue-cli-service` is a binary that was installed when creating the project. It provides a `serve`, `build` and `lint` command which take over tasks that have been previously (in Vue CLI 2) been set up in each project individually.

The `vue-cli-service` is what allows the Vue CLI 3 to scaffold projects without hundreds of lines of webpack configuration. It strips away a lot of configuration while also allowing you to benefit from updates to the `vue-cli-service`, without having to adjust your project's configuration. In Vue CLI 2 updates to a template would go by your project unnoticed, if you did not invest the time to manually apply updates and resolve conflicts.

## Add and configure the official Progressive Web App plugin

We've already talked about the `@vue/cli-service` listed in your project's `devDependencies`. The other two packages, `@vue/cli-plugin-babel` and `@vue/cli-plugin-eslint` are plugins for the Vue CLI 3. 

### Understanding Vue CLI's plugins

The Vue CLI 3 is centered around plugins that can augment either the development or functionality of your application. They can be individually added, removed and updated, in most cases without you having to change anything about your application or configuration. Most plugins also have a sensible default configuration, that means, you don't even have to configure that plugin, only if you want to change its default behaviour. This goes so far as to many plugins not even placing their default configuration in your `package.json` or their separate configuration files.

### `@vue/cli-plugin-babel`

The already installed `@vue/cli-plugin-babel` transforms your ES2015+ code according to the configuration in `babel.config.js`. By default it uses a `@vue/app` preset, making sure your application works on all browsers supported by the Vue framework itself (TODO Add link to the browser support of Vue), and the `browserlist` field in your `package.json`. This field is also used for PostCSS (TODO Add a link to the documentation). 

### `@vue/cli-plugin-eslint`

`@vue/cli-plugin-eslint` checks your code against the `eslintConfig` configuration in your `package.json` files. It does this whenever you make changes to your code (while running the development server via `npm run dev`).

### Adding the Progressive Web App plugin 

Now, if we want to add further plugins we can use the `vue add` command, followed by either the full name of the plugin, or a shorthand version. The following two commands lead to the same result:

```bash
vue add @vue/pwa
vue add @vue/cli-plugin-pwa
```

This will install the `@vue/cli-plugin-pwa` package (TODO Link to npm or GitHub repository), which adds a lot of Progressive Web App functionality to your project. After running it will tell you that it has changed (or added) the following files:

```txt
├── package-lock.json
├── package.json
├── public
│   ├── img
│   │   └── icons
│   │       ├── android-chrome-192x192.png
│   │       ├── android-chrome-512x512.png
│   │       ├── ...
│   ├── manifest.json
│   └── robots.txt
└── src
   ├── main.js
   └── registerServiceWorker.js
```

The plugin added itself and the `register-service-worker` package as dependencies to the `package.json` file. It also added a few files to the `public` folder, all of which you can edit to match your application: a `manifest.json`, `robot.txt` and a set of icons for various devices. It also adds a a few lines that initialize a Service Worker (in `main.js` and `registerServiceWorker.js`), via Google's [Workbox](https://developers.google.com/web/tools/workbox/) libray.

We'll talk about how to configure the Service Worker in the next section. If you're unsure what a Service Worker is or what it's used for in a Progressive Web App -- keep in mind that we're only using it for caching network requests, so that your app (or at least parts of your app) are available offline or in unreliable network conditions.

### Testing the Progressive Web App plugin

The Service Worker is disabled in development mode, because local changes may not show up while you develop your application when files are being cached. This means if you want to test your Progressive Web App you'll have to build your Vue application first. This can be done by simply running `npm run build`. 

You will most likely encounter linting errors when trying to run `npm run build`. To fix them automatically just run `npm run lint --fix` and it will auto-fix `main.js` and `registerServiceWorker.js` to match your ESLint settings.

It's also a good idea to clear Service Workers and Cache Storage for <http://localhost:8080/>, if you have previously served another (Vue) project at this URL. (TODO How does this work in Firefox?) If you don't want to do this you can also just use the browser's incognito mode.

![Chrome Dev Tools > Application > Clear storage > Clear site data](/images/vue-cli-3-pwa/clear-site-data.png)

Now that you've build you application open the `dist` folder that was created and serve your application. You can do this with `npx http-server` or any other HTTP server that can serve files from a folder.

TODO Describe cache storage and how to test offline functionality.

![Cache Storage](/images/vue-cli-3-pwa/cache-storage.png)

![Network ✔️ Offline (from ServiceWorker)](/images/vue-cli-3-pwa/from-service-worker.png)

### Configuring the Progressive Web App plugin

You have already seen where many libraries (Babel, PostCSS, ESLint …) can be configured: In dedicated config files or in `package.json` fields. For many plugins, especially official Vue CLI plugins in the `@vue` namespace there's another place for configuration: `vue.config.js`. 

The `vue.config.js` does not exist when you initially create a project with  Vue CLI 3. You have to create it youself if you want to change the default configuration of your Vue CLI plugins.

Here's an example configuration for my [Japanese Phrasebook](https://japanese-phrasebook.com/) Progressive Web App built with Vue CLI 3:

```js
module.exports = {
  // … other Vue CLI plugin options …
  pwa: {
    name: 'Japanese Phrasebook',
    themeColor: '#f44336',
    msTileColor: '#f44336',
    iconPaths: {
      favicon32: 'img/icons/favicon-32x32.png',
      favicon16: 'img/icons/favicon-16x16.png',
      appleTouchIcon: 'img/icons/apple-touch-icon-180x180.png',
      maskIcon: 'img/icons/safari-pinned-tab.svg',
      msTileImage: 'img/icons/msapplication-icon-144x144.png',
    },
    workboxOptions: {
      cacheId: 'phrasebook',
      importWorkboxFrom: 'local',
      navigateFallback: 'shell.html',
      navigateFallbackWhitelist: [/^((?!\/404).)*$/],
      // … other Workbox options …
    },
  },
};
```

 All configuration options are listed in [@vue/cli-plugin-pwa's README.md](https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa#configuration). You don't have to change any of the default options, if you don't want to, but I suggest that you set the `name`, `themeColor` and `msTileColor` correctly.

## Configure webpack

```js
// vue.config.js
module.exports = {
 configureWebpack: {
   plugins: [
     new MyPlugin()
   ],
 }
};
```

```js
module.exports = {
 configureWebpack: config => {
   if (process.env.NODE_ENV === 'production') {
     // You can mutate the config directly …
   }
   // … or return an object which will be merged.
 }
};
```

```js
module.exports = {
 chainWebpack: config => {
   config
     .plugin('html')
     .tap(args => {
       return [/* … */]
     })
 }
};
```

## Troubleshoot relative file imports

[Documentation](https://cli.vuejs.org/guide/html-and-static-assets.html#building-a-multi-page-app)

> Internally, we use `file-loader` to determine the final file location with version hashes and correct public base paths, and use `url-loader` to conditionally inline assets that are smaller than 4kb, reducing the amount of HTTP requests.

```html
<img src="./assets/logo.svg" alt="Logo">
<!-- becomes -->
<img src="./assets/logo.ec9a16c8.svg" alt="Logo">
```

```bash
vue inspect --rule svg
```

```
{
  test: /\.(svg)(\?.*)?$/,
  use: [{
    loader: 'file-loader',
    options: { name: 'img/[name].[hash:8].[ext]' }
  }]
}
```

`vue.config.js`

```js
module.exports = {
  chainWebpack: (config) => {
    config.module.rules.delete('svg');
    config.module.rule('images')
      .test(/\.(svg|png|jpe?g|gif|webp)(\?.*)?$/);
  }
};
```

```html
<img src="./assets/logo.svg" alt="Logo">
<!-- becomes (after modifying default config) -->
<img src="data:image/svg+xml;base64,..." alt="Logo">
```

## Prerendering pages for SEO

[PrerenderSPAPlugin](https://github.com/chrisvfritz/prerender-spa-plugin)

`vue.config.js`

```js
const path = require('path');
const cheerio = require('cheerio');
const PrerenderSPAPlugin = require('prerender-spa-plugin');

module.exports = {
  configureWebpack: (config) => {
    if (process.env.NODE_ENV !== 'production') {
      return {};
    }
    return {
      plugins: [
        new PrerenderSPAPlugin({
          staticDir: config.output.path,
          routes: ['/', '/404', /* … */],
          renderer: new PrerenderSPAPlugin.PuppeteerRenderer({
            renderAfterDocumentEvent: 'rendered',
          }),
          postProcess(context) {
            if (context.route === '/404') {
              context.outputPath = path.join(config.output.path, '/404.html');
            }
            const $ = cheerio.load(context.html);
            $('[src*="https://www.google-analytics.com/analytics.js"]').remove();
            context.html = $.html();
            return context;
          },
        }),
      ],
    };
  }
};
```

## Audit with WebPagetest and Lighthouse

![100 Lighthouse PWA Score
A First Byte Time
A Keep-alive Enabled
A Compress Transfer
A Compress Images
D Cache static content
✔ Effective use of CDN](/images/vue-cli-3-pwa/webpagetest-score.png)

```
Leverage browser caching of static assets: 60/100

FAILED - (15.0 minutes) - https://www.googletagmanager.com/gtag/js?id=UA-122315460-1
FAILED - (45.7 minutes) - https://www.google-analytics.com/analytics.js
```

## Conclusion

We did talk about

* using the Vue CLI 3 to create a project
* adding and configuring Vue CLI plugins,
* configuring the Progressive Web App plugin,
* configuring webpack,
* prerendering pages for SEO
* and building your application.

We did not tap on

* UI
* Presets (for bypassing the prompts when creating a project)
* Instant Prototyping
* Build Targets (including the `--modern` flag)
* Plugin Development

which I may highlight in further articles, if you're interested.

TODO Hint at the full example application in the links/resources section.


## Resources

* [Vue CLI 3 Guide](https://cli.vuejs.org/guide/)
* [Vue CLI 3 Configuration Reference](https://cli.vuejs.org/config/)

### Official Plugins

* [@vue/cli-plugin-babel](TODO)
* [@vue/cli-plugin-typescript](TODO)
* [@vue/cli-plugin-eslint](TODO)
* [@vue/cli-plugin-pwa](TODO)
* [@vue/cli-plugin-unit-jest](TODO)
* [@vue/cli-plugin-unit-mocha](TODO)
* [@vue/cli-plugin-e2e-cypress](TODO)
* [@vue/cli-plugin-e2e-nightwatch](TODO)

### Full example application

* <https://www.japanese-phrasebook.com/> 
* [master Branch](https://github.com/Lorti/phrasebook/tree/master)
* [vue-cli-2 Branch](https://github.com/Lorti/phrasebook/tree/vue-cli-2)
* [vue-cli-3 Branch](https://github.com/Lorti/phrasebook/tree/vue-cli-3)
